{"version":3,"file":"widget.js","sources":["../../../../src/mixins/widget.js"],"sourcesContent":["import { isVue3 } from '../util/vue-compat';\nimport { warn } from '../util/warn';\n\nexport const createWidgetMixin = ({ connector } = {}) => ({\n  inject: {\n    instantSearchInstance: {\n      from: '$_ais_instantSearchInstance',\n      default() {\n        const tag = this.$options._componentTag;\n        throw new TypeError(\n          `It looks like you forgot to wrap your Algolia search component \"<${tag}>\" inside of an \"<ais-instant-search>\" component.`\n        );\n      },\n    },\n    getParentIndex: {\n      from: '$_ais_getParentIndex',\n      default() {\n        return () => this.instantSearchInstance.mainIndex;\n      },\n    },\n  },\n  data() {\n    return {\n      state: null,\n    };\n  },\n  created() {\n    if (typeof connector === 'function') {\n      this.factory = connector(this.updateState, () => {});\n      this.widget = this.factory(this.widgetParams);\n      this.getParentIndex().addWidgets([this.widget]);\n\n      if (\n        this.instantSearchInstance._initialResults &&\n        !this.instantSearchInstance.started\n      ) {\n        if (typeof this.instantSearchInstance.__forceRender !== 'function') {\n          throw new Error(\n            'You are using server side rendering with <ais-instant-search> instead of <ais-instant-search-ssr>.'\n          );\n        }\n        this.instantSearchInstance.__forceRender(\n          this.widget,\n          this.getParentIndex()\n        );\n      }\n    } else if (connector !== true) {\n      warn(\n        `You are using the InstantSearch widget mixin, but didn't provide a connector.\nWhile this is technically possible, and will give you access to the Helper,\nit's not the recommended way of making custom components.\n\nIf you want to disable this message, pass { connector: true } to the mixin.\n\nRead more on using connectors: https://alg.li/vue-custom`\n      );\n    }\n  },\n  [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n    if (this.widget) {\n      this.getParentIndex().removeWidgets([this.widget]);\n    }\n  },\n  watch: {\n    widgetParams: {\n      handler(nextWidgetParams) {\n        this.state = null;\n        this.getParentIndex().removeWidgets([this.widget]);\n        this.widget = this.factory(nextWidgetParams);\n        this.getParentIndex().addWidgets([this.widget]);\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    updateState(state = {}, isFirstRender) {\n      if (!isFirstRender) {\n        // Avoid updating the state on first render\n        // otherwise there will be a flash of placeholder data\n        this.state = state;\n      }\n    },\n  },\n});\n"],"names":["createWidgetMixin","ref","inject","instantSearchInstance","from","default","tag","this","$options","_componentTag","TypeError","getParentIndex","mainIndex","data","state","created","connector","factory","updateState","widget","widgetParams","addWidgets","_initialResults","started","__forceRender","Error","warn","removeWidgets","watch","handler","nextWidgetParams","deep","methods","isFirstRender"],"mappings":"oFAGaA,WAAqBC,wBAAgB,+BAAQ,CACxDC,OAAQ,CACNC,sBAAuB,CACrBC,KAAM,8BACNC,uBACQC,EAAMC,KAAKC,SAASC,oBACpB,IAAIC,8EAC4DJ,yDAI1EK,eAAgB,CACdP,KAAM,uBACNC,uDACeE,EAAKJ,sBAAsBS,cAI9CC,sBACS,CACLC,MAAO,OAGXC,sBAC2B,mBAAdC,WACJC,QAAUD,EAAUT,KAAKW,+BACzBC,OAASZ,KAAKU,QAAQV,KAAKa,mBAC3BT,iBAAiBU,WAAW,CAACd,KAAKY,SAGrCZ,KAAKJ,sBAAsBmB,kBAC1Bf,KAAKJ,sBAAsBoB,QAC5B,IACwD,mBAA7ChB,KAAKJ,sBAAsBqB,oBAC9B,IAAIC,MACR,2GAGCtB,sBAAsBqB,cACzBjB,KAAKY,OACLZ,KAAKI,wBAGc,IAAdK,GACTU,EACE,uWAUN,yBACMnB,KAAKY,aACFR,iBAAiBgB,cAAc,CAACpB,KAAKY,YAG9CS,MAAO,CACLR,aAAc,CACZS,iBAAQC,QACDhB,MAAQ,UACRH,iBAAiBgB,cAAc,CAACpB,KAAKY,cACrCA,OAASZ,KAAKU,QAAQa,QACtBnB,iBAAiBU,WAAW,CAACd,KAAKY,UAEzCY,MAAM,MAGVC,QAAS,CACPd,qBAAYJ,EAAYmB,kBAAJ,IACbA,SAGEnB,MAAQA"}